{"version":3,"sources":["RouteExplorer.js","polyfills.js","controllers/AppController.js","controllers/Explore.js","controllers/RouteDetailsController.js","controllers/SelectRoutesController.js","controllers/SelectStopsController.js","controllers/TimesDetailsController.js","directives/PercentBar.js","directives/TimesDetails.js","filters/duration.js","services/Layout.js","services/Locale.js","services/LocationBinder.js","services/TimeParser.js"],"names":["app","angular","module","constant","baseDir","config","$routeProvider","env","templateUrl","templateName","when","pageId","controller","resolve","Layout","reloadOnSearch","otherwise","redirectTo","String","prototype","repeat","count","this","TypeError","str","RangeError","Infinity","Math","floor","length","rpt","$scope","$location","share","prefix","url","encodeURIComponent","window","open","$on","e","route","bodyClass","$route","$http","LocationBinder","Locale","TimeParser","days","input","getStats","dayId","timeId","statsMap","selectedStats","stats","selectedDay","selectedTime","stops","loadStats","data","times","timesMap","i","statGroup","info","hours","week_day","time","id","from","formatHour","to","push","hour","slice","formatMonth","date","months","getMonth","name","getFullYear","offsetMonth","offset","d","Date","setMonth","offsetPeriod","period","size","end","routeParams","current","params","parsePeriod","startDate","createRequestString","endDate","routeId","stopIds","findRoute","loaded","origin","destination","selectedPeriod","selectRouteUrl","previousPeriod","nextPeriod","bounds","getRoutesDateRange","day","previousPeriodUrl","min","getTime","formatPeriod","nextPeriodUrl","max","get","route_id","from_date","to_date","success","bind","val","Number","stopStats","stopId","stop_id","stopName","stop","findStop","isDayEmpty","dayTimes","num_trips","isTimeEmpty","timeStats","tripCount","collapseRoutes","routes","countStopFrequencies","stopFrequencies","routeIndex","findCommonStops","routesCount","commonStops","collapseStops","collapsibleStops","accumulator","collapsed","getStops","findRoutesByPeriod","then","isCollapsed","value","isArray","isOrigin","isDestination","stopText","stopTooltip","map","join","barWidth","percentWidth","routeUrl","$rootScope","generatePeriods","fromDate","toDate","periods","start","getDate","toName","until","reverse","dateRange","startPeriod","endPeriod","formValid","goToRoutes","noRoutes","loading","periodStr","path","dismissError","layout","parseInt","directive","restrict","scope","type","filter","seconds","negative","trunc","minutes","res","factory","$q","stopsMap","routesMap","loadedPromise","all","response","s","heb_stop_names","names","forEach","r","stop_ids","minDate","min_date","maxDate","max_date","reduce","m","findRoutes","originId","destinationId","matchingRoutes","originIndex","indexOf","destinationIndex","routeStops","Object","keys","sort","r1","r2","defer","routesInDate","reject","msg","promise","service","getRoutes","v","abbr","scopeProperty","locationProperty","parser","formatter","search","$watch","dd","toString","mm","yyyy","parseMonth","monthString","year","substr","month","periodString","parts","split","f"],"mappings":"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","file":"app.js","sourcesContent":["(function() {\n  var app = angular.module('RouteExplorer', ['ngRoute', 'ui.bootstrap', 'ui.bootstrap.buttons']);\n\n  app.constant('env', {\n    baseDir: '/static/ui/RouteExplorer'\n  });\n\n  app.config(['$routeProvider', 'env',\n  function($routeProvider, env) {\n\n      var templateUrl = function(templateName) {\n          return env.baseDir + '/tpls/' + templateName + '.html';\n      };\n\n      $routeProvider\n          .when('/', {\n              pageId: 'welcome',\n              templateUrl: templateUrl('SelectStops'),\n              controller: 'SelectStopsController',\n              resolve: { 'Layout': 'Layout' }\n          })\n          .when('/about', {\n              pageId: 'about',\n              templateUrl: templateUrl('About')\n          })\n          .when('/:period/select-route/:origin/:destination', {\n              pageId: 'routes',\n              templateUrl: templateUrl('SelectRoute'),\n              controller: 'SelectRouteController',\n              resolve: { 'Layout': 'Layout' },\n              reloadOnSearch: false\n          })\n          .when('/:period/routes/:routeId', {\n              pageId: 'route',\n              templateUrl: templateUrl('RouteDetails'),\n              controller: 'RouteDetailsController',\n              resolve: { 'Layout': 'Layout' },\n              reloadOnSearch: false\n          })\n          .when('/explore', {\n              pageId: 'explore',\n              templateUrl: templateUrl('Explore'),\n              controller: 'ExploreController',\n          })\n          .otherwise({\n              redirectTo: '/'\n          });\n  }]);\n})();\n","// String.repeat polyfill\n// taken from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/repeat#Polyfill\nif (!String.prototype.repeat) {\n  String.prototype.repeat = function(count) {\n    'use strict';\n    if (this === null) {\n      throw new TypeError('can\\'t convert ' + this + ' to object');\n    }\n    var str = '' + this;\n    count = +count;\n    if (count != count) {\n      count = 0;\n    }\n    if (count < 0) {\n      throw new RangeError('repeat count must be non-negative');\n    }\n    if (count == Infinity) {\n      throw new RangeError('repeat count must be less than infinity');\n    }\n    count = Math.floor(count);\n    if (str.length === 0 || count === 0) {\n      return '';\n    }\n    // Ensuring count is a 31-bit integer allows us to heavily optimize the\n    // main part. But anyway, most current (August 2014) browsers can't handle\n    // strings 1 << 28 chars or longer, so:\n    if (str.length * count >= 1 << 28) {\n      throw new RangeError('repeat count must not overflow maximum string size');\n    }\n    var rpt = '';\n    for (;;) {\n      if ((count & 1) == 1) {\n        rpt += str;\n      }\n      count >>>= 1;\n      if (count === 0) {\n        break;\n      }\n      str += str;\n    }\n    return rpt;\n  };\n}\n","angular.module('RouteExplorer').controller('AppController',\n['$scope', '$location',\nfunction($scope, $location) {\n    $scope.share = function(prefix) {\n        var url = prefix + encodeURIComponent('http://otrain.org/#' + $location.url());\n        window.open(url, 'sharePopup', 'width=600,height=550,top=100,left=100,location=no,scrollbar=no,status=no,menubar=no');\n    };\n\n    $scope.$on('$routeChangeSuccess', function(e, route) {\n        $scope.bodyClass = route.pageId ? 'rex-page-' + route.pageId : null;\n    });\n}]);\n","angular.module('RouteExplorer').controller('ExploreController',\n['$scope', '$route', '$http', '$location', 'LocationBinder', 'Layout', 'Locale', 'TimeParser',\nfunction($scope, $route, $http, $location, LocationBinder, Layout, Locale, TimeParser) {\n    $scope.days = Locale.days;\n    $scope.input = {\n\n    }\n}]);\n","angular.module('RouteExplorer').controller('RouteDetailsController',\n['$scope', '$route', '$http', '$location', 'LocationBinder', 'Layout', 'Locale', 'TimeParser',\nfunction($scope, $route, $http, $location, LocationBinder, Layout, Locale, TimeParser) {\n    var routeParams = $route.current.params;\n\n    var period = TimeParser.parsePeriod(routeParams.period);\n    var startDate = TimeParser.createRequestString(period.from);\n    var endDate = TimeParser.createRequestString(period.end);\n\n    var routeId = routeParams.routeId;\n    var stopIds = Layout.findRoute(routeId).stops;\n    var statsMap = {};\n\n    $scope.loaded = false;\n    $scope.stopIds = stopIds;\n    $scope.origin = stopIds[0];\n    $scope.destination = stopIds[stopIds.length - 1];\n\n    $scope.selectedPeriod = formatMonth(period.from);\n    if (period.to > period.from) {\n        $scope.selectedPeriod += \" \\u2014 \" + formatMonth(period.to)\n    }\n\n    $scope.selectedDay = null;\n    $scope.days = Locale.days;\n\n    $scope.selectedTime = null;\n    $scope.times = [];\n\n    $scope.selectRouteUrl = '#/' + routeParams.period + '/select-route/' + $scope.origin + '/' + $scope.destination;\n\n    var previousPeriod = offsetPeriod(period, -1);\n    var nextPeriod = offsetPeriod(period, +1);\n    var bounds = Layout.getRoutesDateRange();\n    var day = 10 * 24 * 60 * 60 * 1000;\n    $scope.previousPeriodUrl = bounds.min.getTime() - day < previousPeriod.from.getTime() ? '#/' + TimeParser.formatPeriod(previousPeriod) + '/routes/' + routeId : null;\n    $scope.nextPeriodUrl = bounds.max > nextPeriod.to ? '#/' + TimeParser.formatPeriod(nextPeriod) + '/routes/' + routeId : null;\n\n    $http.get('/api/v1/stats/route-info-full', { params: { route_id: routeId, from_date: startDate, to_date: endDate } })\n        .success(function(data) {\n            loadStats(data);\n            $scope.loaded = true;\n        });\n\n    LocationBinder.bind($scope, 'selectedDay', 'day', function(val) { return val ? Number(val) : null; });\n    LocationBinder.bind($scope, 'selectedTime', 'time');\n\n    $scope.stopStats = function(stopId) {\n        var stats = selectedStats();\n        for (var i in stats) {\n            if (stats[i].stop_id == stopId)\n                return stats[i];\n        }\n        return null;\n    };\n\n    $scope.stopName = function(stopId) {\n        var stop = Layout.findStop(stopId);\n        if (!stop)\n            return null;\n\n            return stop.name;\n    };\n\n    $scope.isDayEmpty = function(day) {\n        var dayId = day.id;\n        var dayTimes = statsMap[dayId];\n\n        if (!dayTimes)\n            return true;\n\n        for (var time in dayTimes)\n            if (dayTimes[time].info.num_trips > 0)\n                return false;\n\n        return true;\n    };\n\n    $scope.isTimeEmpty = function(time) {\n        var dayId = $scope.selectedDay || 'all';\n        var timeId = time.id;\n\n        var timeStats = statsMap[dayId] && statsMap[dayId][timeId];\n        if (timeStats && timeStats.info.num_trips > 0)\n            return false;\n\n        return true;\n    };\n\n    $scope.tripCount = function(dayId, timeId) {\n      var stats = getStats(dayId, timeId);\n      if (!stats)\n        return 0;\n\n      return stats.info.num_trips;\n    };\n\n    function getStats(dayId, timeId) {\n      dayId = dayId || 'all';\n      timeId = timeId || 'all';\n      return statsMap[dayId] && statsMap[dayId][timeId] ? statsMap[dayId][timeId] : null;\n    }\n\n    function selectedStats() {\n        var stats = getStats($scope.selectedDay, $scope.selectedTime);\n        if (stats)\n          return stats.stops;\n\n        return [];\n    }\n\n    function loadStats(data) {\n        $scope.times = [];\n        var timesMap = {};\n\n        for (var i in data) {\n            var statGroup = data[i];\n            var timeId = statGroup.info.hours == 'all' ? 'all' : statGroup.info.hours[0] + '-' + statGroup.info.hours[1];\n            var dayId = statGroup.info.week_day;\n\n            if (!statsMap[dayId])\n                statsMap[dayId] = {};\n\n            statsMap[dayId][timeId] = statGroup;\n\n            if (timeId != 'all' && !timesMap[timeId]) {\n                var time = {\n                    id: timeId,\n                    from: formatHour(statGroup.info.hours[0]),\n                    to: formatHour(statGroup.info.hours[1])\n                };\n                timesMap[timeId] = time;\n                $scope.times.push(time);\n            }\n        }\n    }\n\n    function formatHour(hour) {\n        return ('0' + hour % 24 + '').slice(-2) + ':00';\n    }\n\n    function formatMonth(date) {\n        return Locale.months[date.getMonth()].name + ' ' + date.getFullYear()\n    }\n\n    function offsetMonth(date, offset) {\n        var d = new Date(date);\n        d.setMonth(d.getMonth() + offset);\n        return d;\n    }\n\n    function offsetPeriod(period, offset) {\n        var size =\n            (period.to.getFullYear() - period.from.getFullYear()) * 12 +\n            period.to.getMonth() - period.from.getMonth() + 1;\n\n        return {\n            from: offsetMonth(period.from, size * offset),\n            to: offsetMonth(period.to, size * offset),\n            end: offsetMonth(period.end, size * offset)\n        };\n    }\n}]);\n","angular.module('RouteExplorer').controller('SelectRouteController',\n['$scope', '$http', '$location', '$route', 'Layout', 'TimeParser',\nfunction($scope, $http, $location, $route, Layout, TimeParser) {\n    $scope.stops = Layout.getStops();\n    var period = TimeParser.parsePeriod($route.current.params.period);\n    var origin = Layout.findStop($route.current.params.origin);\n    var destination = Layout.findStop($route.current.params.destination);\n\n    $http.get('/api/v1/stats/path-info-full', { params: {\n        origin: origin.id,\n        destination: destination.id,\n        from_date: TimeParser.createRequestString(period.from),\n        to_date: TimeParser.createRequestString(period.end) }\n    }).success(function(data) {\n            loadStats(data);\n            $scope.loaded = true;\n    });\n\n    var statsMap = {};\n\n    function formatMonth(date) {\n        return Locale.months[date.getMonth()].name + ' ' + date.getFullYear()\n    }\n\n    function formatHour(hour) {\n        return ('0' + hour % 24 + '').slice(-2) + ':00';\n    }\n\n\n    function loadStats(data) {\n        $scope.stats = data;\n    }\n\n    Layout.findRoutesByPeriod(origin.id, destination.id, period.from, period.end).then(function(routes) {\n        if (routes.length > 1)\n            collapseRoutes(routes);\n        $scope.routes = routes;\n\n    });\n\n    function stopName(stopId) {\n        var stop = Layout.findStop(stopId);\n        if (!stop)\n            return null;\n\n        return stop.name;\n    }\n\n    $scope.isCollapsed = function(value) {\n        return angular.isArray(value);\n    };\n\n    $scope.isOrigin = function(stopId) {\n        return stopId == origin.id;\n    };\n\n    $scope.isDestination = function(stopId) {\n        return stopId == destination.id;\n    };\n\n    $scope.stopText = function(stopId) {\n        if ($scope.isCollapsed(stopId))\n            return \"\\u2022\".repeat(stopId.length);\n\n        return stopName(stopId);\n    };\n\n    $scope.stopTooltip = function(stopId) {\n        if (!$scope.isCollapsed(stopId))\n            return null;\n\n        return stopId.map(stopName).join(\", \");\n    };\n\n    $scope.barWidth = function(route) {\n        var percentWidth = route.count * 100.0 / $scope.routes[0].count;\n\n        if (percentWidth < 1.0)\n            return \"1px\";\n\n        return percentWidth + \"%\";\n    };\n\n    $scope.routeUrl = function(route) {\n        return '/#/' + $route.current.params.period + '/routes/' + route.id;\n    };\n\n    function collapseRoutes(routes) {\n        var collapsibleStops = findCommonStops(countStopFrequencies(routes), routes.length);\n        delete collapsibleStops[origin.id];\n        delete collapsibleStops[destination.id];\n\n        for (var routeIndex in routes) {\n            routes[routeIndex].stops = collapseStops(routes[routeIndex].stops, collapsibleStops);\n        }\n\n        function countStopFrequencies(routes) {\n            var stopFrequencies = {};\n            for (var routeIndex in routes) {\n                var route = routes[routeIndex];\n                for (var i in route.stops) {\n                    var stopId = route.stops[i];\n                    if (!stopFrequencies[stopId])\n                        stopFrequencies[stopId] = 0;\n                    stopFrequencies[stopId]++;\n                }\n            }\n\n            return stopFrequencies;\n        }\n\n        function findCommonStops(stopFrequencies, routesCount) {\n            var commonStops = {};\n            for (var stopId in stopFrequencies)\n                if (stopFrequencies[stopId] == routesCount)\n                    commonStops[stopId] = true;\n\n            return commonStops;\n        }\n\n        function collapseStops(stops, collapsibleStops) {\n            var collapsed = [];\n            var accumulator;\n\n            for (var i in stops) {\n                var stopId = stops[i];\n                if (i > 0 && i < stops.length - 1 && collapsibleStops[stopId]) {\n                    if (!accumulator) {\n                        accumulator = [];\n                        collapsed.push(accumulator);\n                    }\n                    accumulator.push(stopId);\n                } else {\n                    accumulator = null;\n                    collapsed.push(stopId);\n                }\n            }\n\n            return collapsed;\n        }\n    }\n}]);\n","angular.module('RouteExplorer').controller('SelectStopsController',\n['$scope', '$rootScope', '$location', 'Layout', 'Locale', 'TimeParser',\nfunction($scope, $rootScope, $location, Layout, Locale, TimeParser) {\n    $scope.stops = Layout.getStops();\n    $scope.origin = null;\n    $scope.destination = null;\n    $scope.months = Locale.months;\n\n    var dateRange = Layout.getRoutesDateRange();\n    $scope.periods = generatePeriods(dateRange.min, dateRange.max);\n    $scope.startPeriod = $scope.periods[0];\n    $scope.endPeriod = $scope.periods[0];\n\n    $scope.formValid = function() {\n        return (\n            !!$scope.origin &&\n            !!$scope.destination &&\n            $scope.origin != $scope.destination &&\n            $scope.startPeriod.from <= $scope.endPeriod.to\n        );\n    };\n\n    $scope.stopName = function(stopId) {\n        var stop = Layout.findStop(stopId);\n        if (!stop)\n            return null;\n\n        return stop.name;\n    };\n\n    $scope.goToRoutes = function() {\n        $scope.noRoutes = false;\n        $scope.loading = true;\n        var period = {\n            from: $scope.startPeriod.from,\n            to: $scope.endPeriod.to,\n            end: $scope.endPeriod.end,\n        };\n        var fromDate = period.from;\n        var toDate = period.end;\n        var periodStr = TimeParser.formatPeriod(period);\n        Layout.findRoutesByPeriod($scope.origin.id, $scope.destination.id, fromDate, toDate)\n            .then(function(routes) {\n                if (routes.length === 0) {\n                    $scope.noRoutes = true;\n                } else if (routes.length == 1) {\n                    $location.path('/' + periodStr + '/routes/' + routes[0].id);\n                } else {\n                    $location.path('/' + periodStr + '/select-route/' + $scope.origin.id + '/' + $scope.destination.id);\n                }\n            })\n            .finally(function() {\n                $scope.loading = false;\n            });\n    };\n\n    $scope.dismissError = function() {\n        $scope.noRoutes = false;\n    };\n\n    function generatePeriods(fromDate, toDate) {\n      // fromDate=1970-1-1 due to a data bug. This is a quick temporary workaround\n      if (fromDate.getFullYear() < 2013) fromDate = new Date(2013, 0, 1);\n\n      var periods = [];\n      var start = new Date(fromDate.getFullYear(), fromDate.getMonth(), 1);\n      while (start < toDate) {\n        end = new Date(start.getFullYear(), start.getMonth() + 1, start.getDate());\n        var period = {\n          from: start,\n          to: start,\n          end: end,\n          name: Locale.months[start.getMonth()].name + \" \" + start.getFullYear()\n        };\n        period.toName = Locale.until + period.name;\n        periods.push(period);\n        start = end;\n      }\n      periods.reverse();\n      return periods;\n    }\n}]);\n","angular.module('RouteExplorer').controller('TimesDetailsController',\n    ['$scope', '$route', 'Locale','LocationBinder','Layout',\nfunction($scope, $route, Locale, LocationBinder, Layout) {\n    Layout.then(function(Layout) {\n        $scope.layout = Layout;\n    });\n    $scope.layout = null;\n\n    var statsMap = {};\n    var routeParams = $route.current.params;\n    $scope.stopIds = [parseInt(routeParams.origin), parseInt(routeParams.destination)];\n    LocationBinder.bind($scope, 'selectedDay', 'day', function(val) { return val ? Number(val) : null; });\n    LocationBinder.bind($scope, 'selectedTime', 'time');\n    function formatHour(hour) {\n        return ('0' + hour % 24 + '').slice(-2) + ':00';\n    }\n\n    function formatMonth(date) {\n        return Locale.months[date.getMonth()].name + ' ' + date.getFullYear()\n    }\n\n    function selectedStats() {\n        var stats = getStats($scope.selectedDay, $scope.selectedTime);\n        if (stats)\n          return stats.stops;\n\n        return [];\n    }\n\n    $scope.stopName = function(stopId) {\n        if ($scope.layout) {\n            var stop = $scope.layout.findStop(stopId);\n            if (!stop)\n                return null;\n\n            return stop.name;\n        } else {\n            return null;\n        }\n    };\n\n    $scope.selectedDay = null;\n    $scope.days = Locale.days;\n\n    $scope.selectedTime = null;\n    $scope.times = [];\n\n    $scope.loadStats = function() {\n        var data = $scope.stats;\n        $scope.times = [];\n        var timesMap = {};\n\n        for (var i in data) {\n            var statGroup = data[i];\n            var timeId = statGroup.info.hours == 'all' ? 'all' : statGroup.info.hours[0] + '-' + statGroup.info.hours[1];\n            var dayId = statGroup.info.week_day;\n\n            if (!statsMap[dayId])\n                statsMap[dayId] = {};\n\n            statsMap[dayId][timeId] = statGroup;\n\n            if (timeId != 'all' && !timesMap[timeId]) {\n                var time = {\n                    id: timeId,\n                    from: formatHour(statGroup.info.hours[0]),\n                    to: formatHour(statGroup.info.hours[1])\n                };\n                timesMap[timeId] = time;\n                $scope.times.push(time);\n            }\n        }\n    };\n    $scope.tripCount = function(dayId, timeId) {\n      var stats = getStats(dayId, timeId);\n      if (!stats)\n        return 0;\n\n      return stats.info.num_trips;\n    };\n\n    function getStats(dayId, timeId) {\n      dayId = dayId || 'all';\n      timeId = timeId || 'all';\n      return statsMap[dayId] && statsMap[dayId][timeId] ? statsMap[dayId][timeId] : null;\n    }\n\n    $scope.isTimeEmpty = function(time) {\n        var dayId = $scope.selectedDay || 'all';\n        var timeId = time.id;\n\n        var timeStats = statsMap[dayId] && statsMap[dayId][timeId];\n        if (timeStats && timeStats.info.num_trips > 0)\n            return false;\n\n        return true;\n    };\n\n    $scope.stopStats = function(stopId) {\n        var stats = selectedStats();\n        for (var i in stats) {\n            if (stats[i].stop_id == stopId)\n                return stats[i];\n        }\n        return null;\n    };\n\n    $scope.loadStats();\n}]);\n\n","angular.module('RouteExplorer').directive(\"rexPercentBar\",\n['env',\nfunction(env) {\n    return {\n        restrict: 'E',\n        scope: {\n          value: '=value',\n          type: '=type'\n        },\n        templateUrl: env.baseDir + '/tpls/PercentBar.html'\n      };\n}]);\n","angular.module('RouteExplorer').directive(\"timesDetails\",\n['env','Layout',\nfunction(env, Layout) {\n    return {\n        restrict: 'E',\n        scope: {\n            stats: '='\n        },\n        controller: 'TimesDetailsController',\n        templateUrl: env.baseDir + '/tpls/TimesDetails.html'\n      };\n}]);\n","angular.module('RouteExplorer').filter('duration', function() {\n    return function(seconds) {\n        var negative = false;\n        seconds = Math.trunc(seconds);\n        if (seconds < 0) {\n            negative = true;\n            seconds = -seconds;\n        }\n\n        var minutes = Math.trunc(seconds / 60);\n        seconds -= minutes * 60;\n        var hours = Math.trunc(minutes / 60);\n        minutes -= hours * 60;\n\n        if (seconds < 10) seconds = '0' + seconds;\n        if (minutes < 10 && hours !== 0) minutes = '0' + minutes;\n\n        var res = minutes + ':' + seconds;\n        if (hours !== 0)\n            res = hours + ':' + res;\n\n        if (negative)\n            res = '-' + res;\n\n        return res;\n    };\n});\n","angular.module('RouteExplorer').factory('Layout',\n['$http', '$q', 'TimeParser',\nfunction($http, $q, TimeParser) {\n    var self = this;\n    var stops = [];\n    var stopsMap = {};\n    var routes = [];\n    var routesMap = {};\n\n    var loadedPromise = $q.all([\n        $http.get('/api/v1/stops')\n            .then(function(response) {\n                stops = response.data.map(function(s) { return { id: s.stop_id, name: s.heb_stop_names[0], names: s.heb_stop_names }; });\n                stops.forEach(function(s) { stopsMap[s.id] = s; });\n            }),\n\n        $http.get('/api/v1/routes/all/')\n            .then(function(response) {\n                routes = response.data.map(function(r) { return {\n                    id: r.id,\n                    stops: r.stop_ids,\n                    count: r.count,\n                    minDate: new Date(r.min_date),\n                    maxDate: new Date(r.max_date)\n                }; });\n\n                routesMap = routes.reduce(function(m, r) { m[r.id] = r; return m; }, {});\n            })\n    ]);\n\n    var findStop = function(stopId) {\n        return stopsMap[stopId] || null;\n    };\n\n    var findRoutes = function(routes, originId, destinationId) {\n        var matchingRoutes = {};\n\n        routes.forEach(function(r) {\n            var originIndex = r.stops.indexOf(originId);\n            var destinationIndex = r.stops.indexOf(destinationId);\n\n            if (originIndex < 0 || destinationIndex < 0)\n                return;\n\n            if (originIndex > destinationIndex)\n                return;\n\n            var routeStops = r.stops;\n            var routeId = r.id;\n\n            if (routeId in matchingRoutes)\n                matchingRoutes[routeId].count += r.count;\n            else {\n                matchingRoutes[routeId] = {\n                    id: routeId,\n                    stops: routeStops,\n                    count: r.count\n                };\n            }\n        });\n\n        matchingRoutes = Object.keys(matchingRoutes).map(function(routeId) { return matchingRoutes[routeId]; });\n        matchingRoutes.sort(function(r1, r2) { return r2.count - r1.count; });\n        return matchingRoutes;\n    };\n\n    var findRoutesByPeriod = function(origin, destination, from, to) {\n        // TODO use minDate and maxDate from our cached routes to avoid the http request\n\n        var d = $q.defer();\n        var matchingRoutes = findRoutes(routes, origin, destination);\n        if (matchingRoutes.length === 0) {\n            d.resolve([]);\n        } else {\n            var fromDate = from;\n            var toDate = to;\n\n            $http.get('/api/v1/routes/all-by-date', {\n                params: {\n                    from_date: TimeParser.createRequestString(fromDate),\n                    to_date: TimeParser.createRequestString(toDate)\n                }\n            }).then(function(response) {\n                var routesInDate = response.data.map(function(r) {\n                    return {\n                        id: r.id,\n                        stops: r.stop_ids,\n                        count: r.count\n                    };\n                });\n                d.resolve(findRoutes(routesInDate, origin, destination));\n            }, function(response) { d.reject({ 'msg': 'Error fetching routes', 'response': response }); });\n        }\n\n        return d.promise;\n    };\n\n    var findRoute = function(routeId) {\n        return routesMap[routeId] || null;\n    };\n\n    var getRoutesDateRange = function() {\n        var max = new Date(1900, 0, 1);\n        var min = new Date(2100, 0, 1);\n\n        for (var i in routes) {\n            var route = routes[i];\n            if (route.count === 0)\n              continue;\n\n            if (route.minDate && route.minDate < min) min = route.minDate;\n            if (route.maxDate && route.maxDate > max) max = route.maxDate;\n        }\n        return {\n          min: min,\n          max: max\n        };\n    };\n\n    service = {\n        getStops: function() { return stops; },\n        getRoutes: function() { return routes; },\n        findRoute: findRoute,\n        findStop: findStop,\n        findRoutes: function(origin, destination) { return findRoutes(routes, origin, destination); },\n        findRoutesByPeriod: findRoutesByPeriod,\n        getRoutesDateRange: getRoutesDateRange\n    };\n\n    return loadedPromise.then(function() { return service; });\n}]);\n","angular.module('RouteExplorer').constant('Locale', {\n  months: [\n      'ינואר',\n      'פברואר',\n      'מרץ',\n      'אפריל',\n      'מאי',\n      'יוני',\n      'יולי',\n      'אוגוסט',\n      'ספטמבר',\n      'אוקטובר',\n      'נובמבר',\n      'דצמבר'\n  ].map(function(v, i) { return { id: i + 1, name: v }; }),\n\n  days: [\n      { abbr: 'א', name: 'ראשון', id: 1 },\n      { abbr: 'ב', name: 'שני', id: 2 },\n      { abbr: 'ג', name: 'שלישי', id: 3 },\n      { abbr: 'ד', name: 'רביעי', id: 4 },\n      { abbr: 'ה', name: 'חמישי', id: 5 },\n      { abbr: 'ו', name: 'שישי', id: 6 },\n      { abbr: 'ש', name: 'שבת', id: 7 }\n  ],\n  until: 'עד ל'\n});\n","angular.module('RouteExplorer').factory('LocationBinder',\n['$location',\nfunction($location) {\n    return {\n        bind: function(scope, scopeProperty, locationProperty, parser, formatter) {\n            scope[scopeProperty] = $location.search()[locationProperty] || null;\n\n            scope.$watch(scopeProperty, function(value) {\n                if (formatter)\n                    value = formatter(value);\n\n                $location.search(locationProperty, value);\n            });\n\n            scope.$watch(function() { return $location.search()[locationProperty] || null; }, function(value) {\n                if (parser)\n                    value = parser(value);\n\n                scope[scopeProperty] = value;\n            });\n        }\n    };\n}]);\n","angular.module('RouteExplorer').factory('TimeParser',\n[\nfunction() {\n    function createRequestString(date) {\n        var dd = date.getDate().toString();\n        var mm = (date.getMonth()+1).toString();\n        var yyyy = date.getFullYear().toString();\n        return dd + '/' + mm + '/' + yyyy;\n    }\n\n    function parseMonth(monthString) {\n        var year = Number(monthString.substr(0, 4));\n        var month = Number(monthString.substr(4, 2));\n        return new Date(year, month - 1, 1);\n    }\n\n    function parsePeriod(periodString) {\n        var parts = periodString.split('-', 2);\n        var from = parseMonth(parts[0]);\n        var to = parts.length > 1 ? parseMonth(parts[1]) : from;\n        var end = new Date(to.getFullYear(), to.getMonth() + 1, 1);\n        return { from: from, to: to, end: end };\n    }\n\n    function formatMonth(date) {\n        return date.getFullYear() + ('0' + (date.getMonth() + 1)).slice(-2);\n    }\n\n    function formatPeriod(period) {\n        var f = formatMonth(period.from);\n        if (period.from < period.to)\n            f += '-' + formatMonth(period.to);\n\n        return f;\n    }\n\n    return {\n        createRequestString: createRequestString,\n        parseMonth: parseMonth,\n        parsePeriod: parsePeriod,\n        formatMonth: formatMonth,\n        formatPeriod: formatPeriod\n    }\n}]);\n"],"sourceRoot":"/source/"}